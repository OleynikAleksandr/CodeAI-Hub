# Session Interface Skeleton

## Назначение
- Обеспечить визуальный каркас сессии до подключения реального Session Orchestrator.
- Показать пользователю ключевые блоки (табы, историю сообщений, TODO, статус, поле ввода) после создания сессии через Provider Picker.
- Сохранить архитектурное разбиение на мелкие компоненты и строгую типизацию без использования `any`.

## Структура
- **session-view.tsx** — корневой контейнер UI сессии; комбинирует табы, диалог, TODO, статус и поле ввода.
- **session-tabs.tsx** — вкладки сессий; отображают комбинацию провайдеров и позволяют переключаться/закрывать сессии.
- **dialog-panel.tsx** — список сообщений (system/assistant/user) с временными текстами, подтверждающими создание сессии и операции пользователя.
- **todo-panel.tsx** — список задач с чекбоксами; toggles обновляют локальное состояние.
- **status-panel.tsx** — краткая сводка по выбранным провайдерам, токенам и состоянию соединения.
- **input-panel.tsx** — текстовое поле и кнопка отправки; отправка добавляет пользовательское сообщение и заглушечный ответ ассистента.

## Поток событий
1. `HomeViewMessageRouter` отправляет `session:created` при успешном запуске сессии (`SessionLauncher`).
2. `index.tsx` фиксирует событие, создаёт `SessionSnapshot` с дефолтными сообщениями/TODO/статусом и активирует вкладку.
3. Пользователь может переключаться между сессиями, закрывать их (`session-tabs`) и обновлять чекбоксы (`todo-panel`).
4. Ввод текста приводит к добавлению пользовательского сообщения и заглушечного ответа, при этом обновляется статус (token usage, время обновления).
5. Команды `clearSession` и `lastSession` транслируются как `session:clearAll` и `session:focusLast`.

## Связанные типы и утилиты
- `src/types/session.ts` — описания сообщений, TODO, статуса, сессии и снепшота.
- `src/webview/ui/src/session/helpers.ts` — общие функции (валидация дескрипторов, создание снепшота, сбор отображаемых меток).
- `src/webview/ui/src/vscode.ts` — безопасное получение VS Code API и постинг сообщений.

## Дальнейшие шаги
- Интегрировать реальный Session Orchestrator и заменить заглушечные сообщения.
- Сохранять черновики и прогресс TODO в persistence слоях, синхронизируя с core-уровнем.
- Подключить потоковые обновления статуса (usage metrics, connection state) от orchestrator'а.

## Актуальный визуальный стиль (2025-10-20)
- Активные вкладки и все панели (`DialogPanel`, `TodoPanel`, `InputPanel`, `StatusPanel`) используют фон `rgba(40, 41, 42, 1)` и обводку `rgba(67, 68, 70, 1)`; неактивные вкладки возвращены к базовому тону `rgba(21, 21, 21, 1)` с границей `rgba(0, 0, 0, 1)` для контраста.
- Оболочка webview (`app-shell`) держит фон `rgba(31, 31, 31, 1)`, Action Bar прижат к краям, рендерится React-компонентом `ActionBar` и использует двутоновые рельсы `#56595C → #18191B` с новыми токенами кнопок `#295687/#577ab3 → #2d7fcb/#61aff6`.
- Provider Picker выравнивает сообщения о статусе выбора по левой стороне, а кнопки `Cancel`/`Start session` сгруппированы справа без изменения высоты диалога.
- Пустое состояние (`Create your first session`) полностью прозрачно к базовому фону `session-region`, чтобы избежать дополнительного слоя с цветом `37, 37, 40`.
